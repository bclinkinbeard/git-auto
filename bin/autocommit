#!/usr/bin/env node

/**
 * Dependencies.
 */

var program = require('commander');
var git = require('simple-git')();
var exec = require('child_process').exec;

/**
 * Program.
 */

program
  .version('0.0.1')
  .parse(process.argv);
  
/**
 * Autocommit.
 */

git.status(function(err, res){
  var deleted = [];

  Object.keys(res).forEach(function(key){
    res[key].forEach(function(file){
      switch (key) {
        case 'not_added':
          git.add(file);
          git.commit('added ' + file.toLowerCase(), [file]);
          break;
        case 'deleted':
          deleted.push(file);
          break;
        case 'modified':
          git.add(file);
          git.commit('updated ' + file.toLowerCase(), [file]);
          break;
        default:
          console.log('Unrecognized key');
      }
    });
  });

  if (!deleted.length) return;

  if (deleted.length === 1) {
    git.add(deleted[0]);
    return git.commit('deleted ' + deleted[0]);
  } else {
    deleted.forEach(function(file){ git.add(file); });
    git.commit('deleted various files');
  }
});
